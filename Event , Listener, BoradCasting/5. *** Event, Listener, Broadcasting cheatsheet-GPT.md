
---

# Laravel Events, Listeners, Broadcasting & Jobs Cheat Sheet

## 1. Events & Listeners

### Step 1: Create an Event

```bash
php artisan make:event UserRegistered
```

**Event Class Example** (`app/Events/UserRegistered.php`):

```php
class UserRegistered implements ShouldQueue
{
    use Dispatchable, InteractsWithSockets, SerializesModels;

    public $user;

    public function __construct(User $user)
    {
        $this->user = $user;
    }
}
```

---

### Step 2: Create a Listener

```bash
php artisan make:listener SendWelcomeEmail --event=UserRegistered
```

**Listener Example** (`app/Listeners/SendWelcomeEmail.php`):

```php
class SendWelcomeEmail
{
    public function handle(UserRegistered $event)
    {
        Mail::to($event->user->email)->send(new WelcomeMail($event->user));
    }
}
```

---

### Step 3: Register Event & Listener

```php
// app/Providers/EventServiceProvider.php
protected $listen = [
    UserRegistered::class => [
        SendWelcomeEmail::class,
    ],
];
```

---

### Step 4: Trigger Event

```php
$user = User::create([...]);
event(new UserRegistered($user));
// or
UserRegistered::dispatch($user);
```

---

## 2. Broadcasting (Real-Time)

### Create Broadcastable Event

```bash
php artisan make:event OrderShipped
```

**Event Class Example**:

```php
class OrderShipped implements ShouldBroadcast
{
    use Dispatchable, InteractsWithSockets, SerializesModels;

    public $order;

    public function __construct(Order $order)
    {
        $this->order = $order;
    }

    public function broadcastOn()
    {
        return new PrivateChannel('orders.'.$this->order->user_id);
    }
}
```

**Trigger Broadcast**

```php
OrderShipped::dispatch($order);
```

**Frontend (JS)**

```js
Echo.private('orders.1')
    .listen('OrderShipped', (e) => console.log('Order shipped:', e.order));
```

---

## 3. Jobs & Queue

### Create a Job

```bash
php artisan make:job SendEmailJob
```

**Job Class Example**

```php
class SendEmailJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    public $user;

    public function __construct(User $user)
    {
        $this->user = $user;
    }

    public function handle()
    {
        Mail::to($this->user->email)->send(new WelcomeMail($this->user));
    }
}
```

### Dispatch Job

```php
SendEmailJob::dispatch($user);
SendEmailJob::dispatch($user)->delay(now()->addMinutes(5));
SendEmailJob::dispatchSync($user); // runs immediately
```

---

### Queue Setup

* `.env`:

```
QUEUE_CONNECTION=database
```

* Create tables:

```bash
php artisan queue:table
php artisan migrate
```

* Run worker:

```bash
php artisan queue:work
```

---

### Delayed & Chained Jobs

```php
// Delayed job
SendEmailJob::dispatch($user)->delay(now()->addMinutes(10));

// Chained jobs
SendEmailJob::withChain([
    new GenerateReportJob($user),
    new NotifyAdminJob($user)
])->dispatch($user);
```

---

## 4. Practical Example: Order Submission with Email & SMS

### Controller Example

```php
public function submitOrder(Request $request)
{
    $user = auth()->user();
    $order = Order::create([
        'user_id' => $user->id,
        'amount'  => $request->amount,
        'status'  => 'pending'
    ]);

    // Dispatch notification job
    SendOrderNotificationJob::dispatch($order);

    return response()->json(['success'=>true,'order_id'=>$order->id]);
}
```

### Job Class (`SendOrderNotificationJob.php`)

```php
class SendOrderNotificationJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    public $order;

    public function __construct(Order $order)
    {
        $this->order = $order;
    }

    public function handle()
    {
        $user = $this->order->user;

        // Email
        Mail::to($user->email)->send(new OrderPlacedMail($this->order));

        // SMS (via Twilio/Nexmo)
        $smsService = new SmsService();
        $smsService->send($user->phone, "Your order #{$this->order->id} is placed successfully!");
    }
}
```

**Notes:**

* Jobs handle async execution.
* Queue worker must be running.
* Works in real projects after learning from this cheat sheet.

---

This is now a **concise, practical, real-project-ready Laravel cheat sheet** for:

* Events & Listeners
* Broadcasting
* Jobs & Queue
* Order submission with Email & SMS notifications

---

