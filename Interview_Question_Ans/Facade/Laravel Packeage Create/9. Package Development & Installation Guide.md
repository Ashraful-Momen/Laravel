# Package Development & Installation Guide

## 1. Creating Your Package

### Step 1: Create Package Directory Structure
```bash
mkdir my-calculator-package
cd my-calculator-package
```

### Step 2: Initialize Composer
```bash
composer init
```

Follow the prompts and use the `composer.json` provided above.

### Step 3: Create the directory structure
```bash
mkdir -p src/Facades
mkdir config
mkdir tests
```

### Step 4: Copy all the files provided above to their respective locations

## 2. Local Development

### Method 1: Path Repository (Recommended for Development)

In your Laravel project's `composer.json`, add:

```json
{
    "repositories": [
        {
            "type": "path",
            "url": "../my-calculator-package"
        }
    ],
    "require": {
        "yourvendor/laravel-calculator": "*"
    }
}
```

Then run:
```bash
composer update
```

### Method 2: Direct Loading

In your Laravel project's `composer.json`:

```json
{
    "autoload": {
        "psr-4": {
            "YourVendor\\Calculator\\": "path/to/your/package/src/"
        }
    }
}
```

Then run:
```bash
composer dump-autoload
```

And manually register the service provider in `config/app.php`:

```php
'providers' => [
    // Other providers...
    YourVendor\Calculator\CalculatorServiceProvider::class,
],

'aliases' => [
    // Other aliases...
    'Calculator' => YourVendor\Calculator\Facades\Calculator::class,
],
```

## 3. Testing Your Package

### In the package directory:
```bash
# Install dependencies
composer install

# Run tests
./vendor/bin/phpunit
```

### In your Laravel application:
```php
// routes/web.php
Route::get('/test-calculator', function () {
    $results = [
        'add' => Calculator::add(10, 5),
        'subtract' => Calculator::subtract(10, 3),
        'multiply' => Calculator::multiply(4, 7),
        'divide' => Calculator::divide(20, 4),
        'chain' => Calculator::reset()
            ->add(10)
            ->add(5)
            ->subtract(3)
            ->getResult(),
        'history' => Calculator::getHistory()
    ];
    
    return response()->json($results);
});
```

## 4. Publishing to Packagist

### Step 1: Create a GitHub repository
```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin https://github.com/yourusername/laravel-calculator.git
git push -u origin main
```

### Step 2: Submit to Packagist
1. Go to https://packagist.org
2. Sign in with GitHub
3. Click "Submit"
4. Enter your GitHub repository URL
5. Click "Check"

### Step 3: Set up auto-update (webhook)
1. In your GitHub repository settings
2. Go to Webhooks
3. Add Packagist's webhook URL
4. Select "Just the push event"

## 5. Installing from Packagist

Once published:

```bash
composer require yourvendor/laravel-calculator
```

## 6. Usage in Laravel

```php
<?php

namespace App\Http\Controllers;

use Calculator;
use Illuminate\Http\Request;

class MathController extends Controller
{
    public function calculate(Request $request)
    {
        $operation = $request->input('operation');
        $a = $request->input('a');
        $b = $request->input('b');
        
        try {
            switch ($operation) {
                case 'add':
                    $result = Calculator::add($a, $b);
                    break;
                case 'subtract':
                    $result = Calculator::subtract($a, $b);
                    break;
                case 'multiply':
                    $result = Calculator::multiply($a, $b);
                    break;
                case 'divide':
                    $result = Calculator::divide($a, $b);
                    break;
                default:
                    return response()->json(['error' => 'Invalid operation'], 400);
            }
            
            return response()->json([
                'result' => $result,
                'history' => Calculator::getHistory()
            ]);
            
        } catch (\Exception $e) {
            return response()->json(['error' => $e->getMessage()], 400);
        }
    }
}
```

## 7. Package Structure Explained

### Service Provider Registration Flow:
1. Laravel loads `CalculatorServiceProvider`
2. `register()` method binds 'calculator' to `CalculatorService`
3. `boot()` method publishes config files

### Facade Resolution Flow:
1. `Calculator::add(5, 3)` is called
2. PHP can't find static method `add`
3. `__callStatic` is triggered (inherited from Laravel's Facade)
4. `getFacadeAccessor()` returns 'calculator'
5. Laravel looks up 'calculator' in service container
6. Returns `CalculatorService` instance
7. Calls `add(5, 3)` on the instance

## 8. Troubleshooting

### Package not found
```bash
composer clear-cache
composer update
```

### Class not found
```bash
composer dump-autoload
php artisan clear-compiled
php artisan config:clear
```

### Facade not working
Make sure the facade is registered in `config/app.php` aliases array.

## That's it! 

You now have a fully functional Laravel package with Facade support!
