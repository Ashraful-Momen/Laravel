
---

# Laravel ORM Comprehensive Developer Guide (Updated)

## Basic Relationships

### One-to-One

**User has one Address** (logical)

```php
// User Model
public function address() {
    return $this->hasOne(Address::class, 'user_id', 'id'); 
    // Table: addresses | FK: user_id -> users.id | PK: id
}

// Address Model
public function user() {
    return $this->belongsTo(User::class, 'user_id', 'id'); 
    // Table: addresses | FK: user_id -> users.id | PK: id
}
```

**Controller Examples**:

```php
// Create User and Address
$user = User::create(['name'=>'Shuvo', 'email'=>'shuvo@test.com']);
$address = new Address(['country'=>'Bangladesh']);

// Save using relationship
$user->address()->save($address);

// Alternative direct create
$user->address()->create(['country'=>'Malaysia']);

// Query examples
$address = $user->address()->first(); 
$user = $address->user()->first();
```

---

### One-to-Many

**User has many Posts**

```php
// User Model
public function posts() {
    return $this->hasMany(Post::class, 'user_id', 'id'); 
    // Table: posts | FK: user_id -> users.id | PK: id
}

// Post Model
public function user() {
    return $this->belongsTo(User::class, 'user_id', 'id'); 
    // Table: posts | FK: user_id -> users.id | PK: id
}
```

**Controller Examples**:

```php
$user = User::find(1);

// Create new post
$user->posts()->create(['title'=>'New Post','content'=>'Lorem']);

// Save existing post
$post = new Post(['title'=>'Second','content'=>'More content']);
$user->posts()->save($post);

// Retrieve
$allPosts = $user->posts()->get();
$firstPost = $user->posts()->first();
```

---

### Many-to-Many

**Posts and Tags**

```php
// Post Model
public function tags() {
    return $this->belongsToMany(Tag::class, 'post_tag', 'post_id', 'tag_id'); 
    // Pivot: post_tag | FK: post_id->posts.id, tag_id->tags.id
}

// Tag Model
public function posts() {
    return $this->belongsToMany(Post::class, 'post_tag', 'tag_id', 'post_id'); 
    // Pivot: post_tag | FK: tag_id->tags.id, post_id->posts.id
}
```

**Controller Examples**:

```php
$post = Post::find(1);
$tag = Tag::find(2);

// Attach / Detach / Sync
$post->tags()->attach($tag->id);     // attach single
$post->tags()->detach([1,3]);        // detach multiple
$post->tags()->sync([2,4]);          // replace with new

// Create a tag via post
$post->tags()->create(['name'=>'Laravel']); 

// Retrieve
$tags = $post->tags()->get();
$posts = $tag->posts()->with('tags')->get();
```

---

### Polymorphic Relationships

**Comments that belong to Posts or Videos**

```php
// Comment Model
public function commentable() {
    return $this->morphTo(); 
    // Table: comments | FK: commentable_id -> posts.id / videos.id | PK: id
}

// Post Model
public function comments() {
    return $this->morphMany(Comment::class, 'commentable'); 
    // Table: comments | FK: commentable_id -> posts.id | PK: id
}

// Video Model
public function comments() {
    return $this->morphMany(Comment::class, 'commentable'); 
    // Table: comments | FK: commentable_id -> videos.id | PK: id
}
```

**Controller Examples**:

```php
$post = Post::find(1);
$video = Video::find(1);

// Create comments
$post->comments()->create(['user_id'=>1,'body'=>'Post Comment']);
$video->comments()->create(['user_id'=>2,'body'=>'Video Comment']);

// Retrieve parent from comment
$comment = Comment::find(1);
$parent = $comment->commentable()->first(); // Post or Video instance
```

---

### Has-Many-Through

**Project → Users → Tasks**

```php
// Project Model
public function tasks() {
    return $this->hasManyThrough(
        Task::class, User::class, 
        'project_id', 'user_id', 
        'id', 'id'
    ); 
    // Tables: projects -> users -> tasks | PK/FK annotated
}
```

**Controller Example**:

```php
$project = Project::find(1);
$tasks = $project->tasks()->get();
```

---

### Summary: Common ORM Methods in Controllers

| Method     | Description                       |
| ---------- | --------------------------------- |
| `save()`   | Save a new/existing related model |
| `create()` | Create and save in one step       |
| `attach()` | Many-to-many attach pivot         |
| `detach()` | Many-to-many detach pivot         |
| `sync()`   | Many-to-many replace pivot        |
| `first()`  | Get first record                  |
| `get()`    | Get all records                   |
| `with()`   | Eager load relationships          |
| `lazy()`   | Lazy load records                 |

---

This version now:

* Fixes logical relationships (User ↔ Address).
* Adds PK/FK table annotations in **every relationship**.
* Adds **concise controller examples** for all common operations.
* Covers **1:1, 1:m, m:m, polymorphic, has-many-through**.

---

Do you want me to make that cheat sheet?
