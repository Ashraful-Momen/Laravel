
---

# Laravel ORM Quick Cheat Sheet

## 1. One-to-One (User ↔ Address)

```php
// User Model
public function address() {
    return $this->hasOne(Address::class, 'user_id', 'id'); 
    // Table: addresses | FK: user_id -> users.id | PK: id
}

// Address Model
public function user() {
    return $this->belongsTo(User::class, 'user_id', 'id'); 
    // Table: addresses | FK: user_id -> users.id | PK: id
}
```

**Controller Examples**:

```php
$user = User::create(['name'=>'Shuvo','email'=>'shuvo@test.com']);
$address = new Address(['country'=>'Bangladesh']);

// save() / create()
$user->address()->save($address);
$user->address()->create(['country'=>'Malaysia']);

// retrieve
$address = $user->address()->first();
$user = $address->user()->first();
```

---

## 2. One-to-Many (User ↔ Posts)

```php
// User Model
public function posts() {
    return $this->hasMany(Post::class, 'user_id', 'id'); 
    // Table: posts | FK: user_id -> users.id | PK: id
}

// Post Model
public function user() {
    return $this->belongsTo(User::class, 'user_id', 'id'); 
    // Table: posts | FK: user_id -> users.id | PK: id
}
```

**Controller Examples**:

```php
$user = User::find(1);

// save() / create()
$user->posts()->create(['title'=>'Post1','content'=>'Lorem']);
$post = new Post(['title'=>'Post2','content'=>'More']);
$user->posts()->save($post);

// retrieve
$allPosts = $user->posts()->get();
$firstPost = $user->posts()->first();
```

---

## 3. Many-to-Many (Posts ↔ Tags)

```php
// Post Model
public function tags() {
    return $this->belongsToMany(Tag::class, 'post_tag', 'post_id', 'tag_id'); 
    // Pivot: post_tag | FK: post_id -> posts.id, tag_id -> tags.id
}

// Tag Model
public function posts() {
    return $this->belongsToMany(Post::class, 'post_tag', 'tag_id', 'post_id'); 
    // Pivot: post_tag | FK: tag_id -> tags.id, post_id -> posts.id
}
```

**Controller Examples**:

```php
$post = Post::find(1);
$tag = Tag::find(2);

// attach / detach / sync
$post->tags()->attach($tag->id);
$post->tags()->detach([1,3]);
$post->tags()->sync([2,4]);

// create via relationship
$post->tags()->create(['name'=>'Laravel']);

// retrieve
$tags = $post->tags()->get();
$posts = $tag->posts()->with('tags')->get();
```

---

## 4. Polymorphic Relationships (Comments ↔ Post/Video)

```php
// Comment Model
public function commentable() {
    return $this->morphTo(); 
    // Table: comments | FK: commentable_id -> posts.id / videos.id | PK: id
}

// Post Model
public function comments() {
    return $this->morphMany(Comment::class, 'commentable'); 
}

// Video Model
public function comments() {
    return $this->morphMany(Comment::class, 'commentable'); 
}
```

**Controller Examples**:

```php
$post = Post::find(1);
$video = Video::find(1);

// create()
$post->comments()->create(['user_id'=>1,'body'=>'Post comment']);
$video->comments()->create(['user_id'=>2,'body'=>'Video comment']);

// retrieve parent
$comment = Comment::find(1);
$parent = $comment->commentable()->first(); // returns Post or Video
```

---

## 5. Has-Many-Through (Project → Users → Tasks)

```php
// Project Model
public function tasks() {
    return $this->hasManyThrough(
        Task::class, User::class,
        'project_id', 'user_id',
        'id', 'id'
    ); 
    // Tables: projects -> users -> tasks | PK/FK annotated
}
```

**Controller Example**:

```php
$project = Project::find(1);
$tasks = $project->tasks()->get();
```

---

## 6. Common Eloquent Methods

| Method     | Usage                           |
| ---------- | ------------------------------- |
| `save()`   | Save new/existing related model |
| `create()` | Create and save in one step     |
| `attach()` | Many-to-many attach pivot       |
| `detach()` | Many-to-many detach pivot       |
| `sync()`   | Many-to-many replace pivot      |
| `first()`  | Get first record                |
| `get()`    | Get all records                 |
| `with()`   | Eager load relationships        |
| `lazy()`   | Lazy load records               |

---

This **cheat sheet** gives you everything you need for **1:1, 1:m, m:m, polymorphic, has-many-through relationships**, including controller operations like `save`, `create`, `attach`, `detach`, `sync`, and queries.

---

Do you want me to make that visual cheat sheet?
