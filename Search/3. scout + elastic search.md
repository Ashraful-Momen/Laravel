Sure. Here’s a **short, practical note** showing how to implement **search, filters, pagination, and geo search** for an **Order model** using **Laravel + Elasticsearch**. This is equivalent to the Typesense setup but uses Elasticsearch as the search engine.

---

## 1. Install required packages

```bash
composer require elasticsearch/elasticsearch
composer require tamayo/laravel-scout-elastic
composer require laravel/scout
```

> `tamayo/laravel-scout-elastic` is a popular Scout driver for Elasticsearch.

---

## 2. Configure `.env`

```env
SCOUT_DRIVER=elastic
ELASTICSEARCH_HOST=127.0.0.1:9200
```

---

## 3. Add `Searchable` trait to Order model

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Laravel\Scout\Searchable;

class Order extends Model
{
    use Searchable;

    protected $fillable = [
        'name', 'description', 'price', 'latitude', 'longitude'
    ];

    // Define what data is indexed in Elasticsearch
    public function toSearchableArray()
    {
        return [
            'id' => $this->id,
            'name' => $this->name,
            'description' => $this->description,
            'price' => $this->price,
            'location' => [
                'lat' => $this->latitude,
                'lon' => $this->longitude
            ]
        ];
    }
}
```

---

## 4. Import existing orders into Elasticsearch

```bash
php artisan scout:import "App\Models\Order"
```

---

## 5. Search example (Controller)

```php
public function search(Request $request)
{
    $query = $request->q;
    $minPrice = $request->min_price ?? 0;
    $maxPrice = $request->max_price ?? 1000000;

    $orders = Order::search($query)
        ->where('price', '>=', $minPrice)
        ->where('price', '<=', $maxPrice)
        ->paginate($request->per_page ?? 20);

    return response()->json($orders);
}
```

---

## 6. Geo search

Elasticsearch supports **geo distance queries**.

```php
$lat = $request->lat;
$lng = $request->lng;
$radius = $request->radius ?? '5km';

$orders = Order::search($request->q)
    ->where('price', '>=', $request->min_price ?? 0)
    ->where('price', '<=', $request->max_price ?? 1000000)
    ->query(function($elastic, $query) use ($lat, $lng, $radius) {
        $elastic->geoDistance('location', [
            'lat' => $lat,
            'lon' => $lng
        ], $radius);
    })
    ->paginate($request->per_page ?? 20);
```

---

## 7. Pagination

Scout + Elasticsearch supports standard pagination:

```php
->paginate($perPage = 20, $pageName = 'page', $page = 1)
```

It returns:

```json
{
  "data": [...],
  "current_page": 1,
  "per_page": 20,
  "total": 150
}
```

---

## 8. Autocomplete (prefix search)

```php
$orders = Order::search($request->q, function($elastic, $query) {
    $elastic->prefix('name', $query);
})->get();
```

---

## 9. Notes for production-ready Elasticsearch search

1. **Define proper mapping** for fields:

   * `text` for full-text fields
   * `keyword` for filters
   * `geo_point` for latitude/longitude
2. **Use queues** for indexing large datasets.
3. **Monitor cluster health**.
4. **Use pagination and size limits** to prevent large queries.
5. **Use filters for numeric/geo fields**, not search queries.

---

### ✅ Summary

With **Laravel + Scout + Elasticsearch**:

* Users can search orders by **name/description**
* **Filter by price**
* **See nearby orders**
* **Paginate results**
* **Autocomplete supported**

Scout handles **Eloquent integration**, while Elasticsearch handles **speed, relevance, and geo queries**.

---

If you want, I can make a **ready-to-use OrderSearchController for Elasticsearch**, fully supporting **filters, geo search, pagination, and autocomplete**, similar to the Typesense version.

Do you want me to do that?
