# Complete S3 Tinker Commands Reference

Here are all the essential tinker commands for S3 testing and management:

## BASIC S3 CONNECTION TESTING

```php
// Enter tinker first
php artisan tinker

// 1. Test basic S3 connection
try {
    $result = Storage::disk('s3')->put('connection-test.txt', 'Connection test - ' . now());
    echo $result ? "✅ S3 Upload Success\n" : "❌ S3 Upload Failed\n";
    
    // Clean up test file
    Storage::disk('s3')->delete('connection-test.txt');
} catch (\Exception $e) {
    echo "❌ Connection Error: " . $e->getMessage() . "\n";
}

// 2. Test S3 read/write cycle
try {
    $testFile = 'read-write-test-' . time() . '.txt';
    $testContent = 'Read/Write test content';
    
    // Upload
    $uploaded = Storage::disk('s3')->put($testFile, $testContent);
    echo "Upload result: " . ($uploaded ? 'Success' : 'Failed') . "\n";
    
    // Read back
    $retrieved = Storage::disk('s3')->get($testFile);
    echo "Content match: " . ($retrieved === $testContent ? 'Yes' : 'No') . "\n";
    echo "Original: " . $testContent . "\n";
    echo "Retrieved: " . $retrieved . "\n";
    
    // Clean up
    Storage::disk('s3')->delete($testFile);
} catch (\Exception $e) {
    echo "Error: " . $e->getMessage() . "\n";
}
```

## BUCKET OPERATIONS

```php
// 3. Check if bucket exists and list available buckets
try {
    $s3Client = new \Aws\S3\S3Client([
        'version' => 'latest',
        'region' => env('S3_REGION', 'us-east-1'),
        'endpoint' => env('S3_ENDPOINT'),
        'use_path_style_endpoint' => true,
        'credentials' => [
            'key' => env('S3_KEY'),
            'secret' => env('S3_SECRET'),
        ],
    ]);
    
    // List all available buckets
    $result = $s3Client->listBuckets();
    echo "Available buckets:\n";
    foreach ($result['Buckets'] as $bucket) {
        echo "- " . $bucket['Name'] . " (Created: " . $bucket['CreationDate'] . ")\n";
    }
    
    // Check if our specific bucket exists
    $bucketName = env('S3_BUCKET');
    $bucketExists = $s3Client->doesBucketExist($bucketName);
    echo "\nBucket '{$bucketName}' exists: " . ($bucketExists ? 'Yes' : 'No') . "\n";
    
} catch (\Exception $e) {
    echo "Bucket check error: " . $e->getMessage() . "\n";
}

// 4. Create bucket if it doesn't exist
try {
    $bucketName = env('S3_BUCKET');
    $s3Client = new \Aws\S3\S3Client([
        'version' => 'latest',
        'region' => env('S3_REGION', 'us-east-1'),
        'endpoint' => env('S3_ENDPOINT'),
        'use_path_style_endpoint' => true,
        'credentials' => [
            'key' => env('S3_KEY'),
            'secret' => env('S3_SECRET'),
        ],
    ]);
    
    if (!$s3Client->doesBucketExist($bucketName)) {
        echo "Creating bucket: {$bucketName}\n";
        $result = $s3Client->createBucket(['Bucket' => $bucketName]);
        echo "Bucket created successfully!\n";
        print_r($result->toArray());
    } else {
        echo "Bucket '{$bucketName}' already exists\n";
    }
} catch (\Exception $e) {
    echo "Bucket creation error: " . $e->getMessage() . "\n";
}
```

## FILE UPLOAD AND MANAGEMENT

```php
// 5. Upload different types of test files
try {
    // Simple text file
    $result1 = Storage::disk('s3')->put('test/simple.txt', 'Simple text content');
    echo "Simple file upload: " . ($result1 ? 'Success' : 'Failed') . "\n";
    
    // File with path structure
    $result2 = Storage::disk('s3')->put('public/assets/test.css', 'body { color: red; }');
    echo "CSS file upload: " . ($result2 ? 'Success' : 'Failed') . "\n";
    
    // Storage file
    $result3 = Storage::disk('s3')->put('storage/uploads/image.txt', 'Fake image content');
    echo "Storage file upload: " . ($result3 ? 'Success' : 'Failed') . "\n";
    
    // Binary-like content
    $result4 = Storage::disk('s3')->put('test/binary.dat', base64_encode('Binary data test'));
    echo "Binary file upload: " . ($result4 ? 'Success' : 'Failed') . "\n";
    
} catch (\Exception $e) {
    echo "Upload error: " . $e->getMessage() . "\n";
}

// 6. Upload from local file
try {
    // Upload a real file from your public directory
    $localFile = public_path('1.php'); // Adjust path as needed
    if (file_exists($localFile)) {
        $content = file_get_contents($localFile);
        $result = Storage::disk('s3')->put('test/uploaded-1.php', $content);
        echo "Local file upload: " . ($result ? 'Success' : 'Failed') . "\n";
    } else {
        echo "Local file not found: {$localFile}\n";
    }
} catch (\Exception $e) {
    echo "Local file upload error: " . $e->getMessage() . "\n";
}
```

## FILE LISTING AND EXPLORATION

```php
// 7. List files in S3 bucket
try {
    // List all files in root
    $allFiles = Storage::disk('s3')->files();
    echo "Total files in root: " . count($allFiles) . "\n";
    foreach (array_slice($allFiles, 0, 10) as $file) {
        echo "- {$file}\n";
    }
    
    // List files in specific directories
    $publicFiles = Storage::disk('s3')->files('public');
    echo "\nPublic files count: " . count($publicFiles) . "\n";
    
    $storageFiles = Storage::disk('s3')->files('storage');
    echo "Storage files count: " . count($storageFiles) . "\n";
    
    $testFiles = Storage::disk('s3')->files('test');
    echo "Test files count: " . count($testFiles) . "\n";
    
} catch (\Exception $e) {
    echo "File listing error: " . $e->getMessage() . "\n";
}

// 8. List directories
try {
    $directories = Storage::disk('s3')->directories();
    echo "Directories in bucket:\n";
    foreach ($directories as $dir) {
        echo "- {$dir}/\n";
    }
} catch (\Exception $e) {
    echo "Directory listing error: " . $e->getMessage() . "\n";
}

// 9. Check file existence
$filesToCheck = [
    'test/simple.txt',
    'public/assets/test.css',
    'storage/uploads/image.txt',
    'public/1.php',
    'nonexistent-file.txt'
];

echo "File existence check:\n";
foreach ($filesToCheck as $file) {
    try {
        $exists = Storage::disk('s3')->exists($file);
        echo "- {$file}: " . ($exists ? 'EXISTS' : 'NOT FOUND') . "\n";
    } catch (\Exception $e) {
        echo "- {$file}: ERROR - " . $e->getMessage() . "\n";
    }
}
```

## URL GENERATION AND ACCESS

```php
// 10. Generate URLs for files
$filesToTest = [
    'test/simple.txt',
    'public/assets/test.css',
    'storage/uploads/image.txt'
];

echo "Generated URLs:\n";
foreach ($filesToTest as $file) {
    try {
        if (Storage::disk('s3')->exists($file)) {
            $url = Storage::disk('s3')->url($file);
            echo "- {$file}: {$url}\n";
        }
    } catch (\Exception $e) {
        echo "- {$file}: URL generation error - " . $e->getMessage() . "\n";
    }
}

// 11. Test URL accessibility with curl
$testUrl = Storage::disk('s3')->url('test/simple.txt');
echo "\nTesting URL accessibility: {$testUrl}\n";

// Note: You'll need to exit tinker and run this curl command in bash:
echo "Run this command in bash to test URL:\n";
echo "curl -I '{$testUrl}'\n";
```

## FILE DOWNLOAD AND CONTENT VERIFICATION

```php
// 12. Download and verify file contents
$filesToDownload = [
    'test/simple.txt' => 'Simple text content',
    'public/assets/test.css' => 'body { color: red; }',
    'storage/uploads/image.txt' => 'Fake image content'
];

echo "Content verification:\n";
foreach ($filesToDownload as $file => $expectedContent) {
    try {
        if (Storage::disk('s3')->exists($file)) {
            $actualContent = Storage::disk('s3')->get($file);
            $match = trim($actualContent) === trim($expectedContent);
            echo "- {$file}: Content match - " . ($match ? 'YES' : 'NO') . "\n";
            if (!$match) {
                echo "  Expected: '{$expectedContent}'\n";
                echo "  Actual: '{$actualContent}'\n";
            }
        } else {
            echo "- {$file}: File not found\n";
        }
    } catch (\Exception $e) {
        echo "- {$file}: Error - " . $e->getMessage() . "\n";
    }
}
```

## CONFIGURATION VERIFICATION

```php
// 13. Verify S3 configuration
echo "S3 Configuration:\n";
$config = config('filesystems.disks.s3');
print_r($config);

echo "\nEnvironment Variables:\n";
$envVars = [
    'S3_KEY', 'S3_SECRET', 'S3_REGION', 'S3_BUCKET', 
    'S3_ENDPOINT', 'S3_URL', 'S3_USE_PATH_STYLE',
    'AWS_ACCESS_KEY_ID', 'AWS_SECRET_ACCESS_KEY', 
    'AWS_DEFAULT_REGION', 'AWS_BUCKET', 'AWS_ENDPOINT'
];

foreach ($envVars as $var) {
    $value = env($var);
    echo "- {$var}: " . ($value ? $value : 'NOT SET') . "\n";
}

// 14. Test Laravel Storage facade configuration
echo "\nStorage disk test:\n";
try {
    $defaultDisk = config('filesystems.default');
    echo "Default disk: {$defaultDisk}\n";
    
    $cloudDisk = config('filesystems.cloud');
    echo "Cloud disk: {$cloudDisk}\n";
    
    // Test default disk
    $result = Storage::put('default-test.txt', 'Default disk test');
    echo "Default disk upload: " . ($result ? 'Success' : 'Failed') . "\n";
    
    // Clean up
    Storage::delete('default-test.txt');
    
} catch (\Exception $e) {
    echo "Storage facade error: " . $e->getMessage() . "\n";
}
```

## PERFORMANCE AND LARGE FILE TESTING

```php
// 15. Test larger file upload
try {
    $largeContent = str_repeat('This is a test line for large file upload.\n', 1000);
    $start = microtime(true);
    
    $result = Storage::disk('s3')->put('test/large-file.txt', $largeContent);
    $uploadTime = microtime(true) - $start;
    
    echo "Large file upload: " . ($result ? 'Success' : 'Failed') . "\n";
    echo "Upload time: " . round($uploadTime, 2) . " seconds\n";
    echo "File size: " . strlen($largeContent) . " bytes\n";
    
    // Test download time
    $start = microtime(true);
    $downloaded = Storage::disk('s3')->get('test/large-file.txt');
    $downloadTime = microtime(true) - $start;
    
    echo "Download time: " . round($downloadTime, 2) . " seconds\n";
    echo "Content match: " . ($downloaded === $largeContent ? 'Yes' : 'No') . "\n";
    
} catch (\Exception $e) {
    echo "Large file test error: " . $e->getMessage() . "\n";
}
```

## CLEANUP AND MAINTENANCE

```php
// 16. Clean up test files
$testFiles = [
    'test/simple.txt',
    'test/uploaded-1.php',
    'test/binary.dat',
    'test/large-file.txt',
    'public/assets/test.css',
    'storage/uploads/image.txt',
    'default-test.txt'
];

echo "Cleaning up test files:\n";
foreach ($testFiles as $file) {
    try {
        if (Storage::disk('s3')->exists($file)) {
            $deleted = Storage::disk('s3')->delete($file);
            echo "- {$file}: " . ($deleted ? 'Deleted' : 'Failed to delete') . "\n";
        } else {
            echo "- {$file}: Not found (already cleaned?)\n";
        }
    } catch (\Exception $e) {
        echo "- {$file}: Delete error - " . $e->getMessage() . "\n";
    }
}

// 17. Final status check
echo "\nFinal S3 status:\n";
try {
    $totalFiles = count(Storage::disk('s3')->files());
    echo "Total files remaining: {$totalFiles}\n";
    
    $publicCount = count(Storage::disk('s3')->files('public'));
    $storageCount = count(Storage::disk('s3')->files('storage'));
    
    echo "Public files: {$publicCount}\n";
    echo "Storage files: {$storageCount}\n";
    
} catch (\Exception $e) {
    echo "Status check error: " . $e->getMessage() . "\n";
}

// Exit tinker when done
exit
```

## QUICK DIAGNOSTIC COMMAND

```php
// 18. All-in-one diagnostic command
echo "=== S3 DIAGNOSTIC REPORT ===\n";

// Connection test
try {
    $testResult = Storage::disk('s3')->put('diagnostic-test.txt', 'Diagnostic test');
    echo "✅ S3 Connection: " . ($testResult ? 'Working' : 'Failed') . "\n";
    Storage::disk('s3')->delete('diagnostic-test.txt');
} catch (\Exception $e) {
    echo "❌ S3 Connection: Failed - " . $e->getMessage() . "\n";
}

// Bucket info
try {
    $bucket = env('S3_BUCKET');
    $files = Storage::disk('s3')->files();
    echo "📁 Bucket '{$bucket}': " . count($files) . " files\n";
} catch (\Exception $e) {
    echo "❌ Bucket access: Failed - " . $e->getMessage() . "\n";
}

// Configuration
echo "⚙️  Endpoint: " . env('S3_ENDPOINT') . "\n";
echo "🔑 Key: " . substr(env('S3_KEY'), 0, 8) . "...\n";
echo "🌍 Region: " . env('S3_REGION') . "\n";

echo "=== END DIAGNOSTIC ===\n";
```

## USAGE INSTRUCTIONS

To run these commands:

1. **Enter your Laravel container:**
   ```bash
   docker exec -it $(docker ps -q -f name=laravel_app) bash
   ```

2. **Start tinker:**
   ```bash
   php artisan tinker
   ```

3. **Copy and paste any of the command blocks above**

4. **Exit tinker when done:**
   ```php
   exit
   ```

These commands will help you thoroughly test your S3 integration, troubleshoot issues, and verify that everything is working correctly.
